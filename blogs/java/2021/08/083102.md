---
title: ReadWriteLockè¯»å†™é”
date: 2021-08-31
sidebar: auto
categories:
 - java
tags:
 - é”
 - å¤šçº¿ç¨‹
---

## ReadWriteLockè¯»å†™é”ç®€å•ä»‹ç»âœ¨

ReentrantLock(å¯é‡å…¥é”)  ä¿è¯äº†åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œä¸´ç•ŒåŒºä»£ç ï¼Œåœ¨ä»»ä½•æ—¶åˆ»ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹æ•°æ®ã€‚ä½†æ˜¯æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»æŸä¸ªæ•°æ®ï¼Œä½†åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å†™ï¼Œå…¶ä»–çº¿ç¨‹å°±å¿…é¡»ç­‰å¾…

::: danger  ä½¿ç”¨  ReadWriteLock  å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜

- åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…¥ï¼ˆå…¶ä»–çº¿ç¨‹æ—¢ä¸èƒ½å†™å…¥ä¹Ÿä¸èƒ½è¯»å–ï¼‰ï¼›
- æ²¡æœ‰å†™å…¥æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹å…è®¸åŒæ—¶è¯»ï¼ˆæé«˜æ€§èƒ½ï¼‰ã€‚

:::

## è¯»å†™é”ğŸ

```java
public class Counter {
    private final ReadWriteLock rwlock = new ReentrantReadWriteLock();
    private final Lock rlock = rwlock.readLock();
    private final Lock wlock = rwlock.writeLock();
    private int[] counts = new int[10];

    public void inc(int index) {
        wlock.lock(); // åŠ å†™é”
        try {
            counts[index] += 1;
        } finally {
            wlock.unlock(); // é‡Šæ”¾å†™é”
        }
    }

    public int[] get() {
        rlock.lock(); // åŠ è¯»é”
        try {
            return Arrays.copyOf(counts, counts.length);
        } finally {
            rlock.unlock(); // é‡Šæ”¾è¯»é”
        }
    }
}
```

æŠŠè¯»å†™æ“ä½œåˆ†åˆ«ç”¨è¯»é”å’Œå†™é”æ¥åŠ é”ï¼Œåœ¨è¯»å–æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å¾—è¯»é”ï¼Œè¿™æ ·å°±å¤§å¤§æé«˜äº†å¹¶å‘è¯»çš„æ‰§è¡Œæ•ˆç‡ã€‚

ä½¿ç”¨ReadWriteLockæ—¶ï¼Œé€‚ç”¨æ¡ä»¶æ˜¯åŒä¸€ä¸ªæ•°æ®ï¼Œæœ‰å¤§é‡çº¿ç¨‹è¯»å–ï¼Œä½†ä»…æœ‰å°‘æ•°çº¿ç¨‹ä¿®æ”¹ã€‚

ä¾‹å¦‚ï¼Œä¸€ä¸ªè®ºå›çš„å¸–å­ï¼Œå›å¤å¯ä»¥çœ‹åšå†™å…¥æ“ä½œï¼Œå®ƒæ˜¯ä¸é¢‘ç¹çš„ï¼Œä½†æ˜¯ï¼Œæµè§ˆå¯ä»¥çœ‹åšè¯»å–æ“ä½œï¼Œæ˜¯éå¸¸é¢‘ç¹çš„ï¼Œè¿™ç§æƒ…å†µå°±å¯ä»¥ä½¿ç”¨ReadWriteLockã€‚

## **å°ç»“â­•**

**ä½¿ç”¨ReadWriteLockå¯ä»¥æé«˜è¯»å–æ•ˆç‡ï¼š**

- **ReadWriteLockåªå…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…¥ï¼›**
- **ReadWriteLockå…è®¸å¤šä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰å†™å…¥æ—¶åŒæ—¶è¯»å–ï¼›**

- **ReadWriteLocké€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚**
