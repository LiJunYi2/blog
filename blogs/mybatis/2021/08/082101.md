---
title: MyBatisæ ¸å¿ƒç±»åˆ—è¡¨
date: 2021-08-21
sidebar: auto
sticky: 4
categories:
 - mybatis
tags:
 - mybatis core
---
## æ¦‚è¿°ğŸ¥–

**MyBatisä¸»è¦çš„æ ¸å¿ƒç±»åŒ…æ‹¬ï¼šSqlSessionFactoryBuilderï¼ŒSqlSessionFactoryï¼ŒSqlSessionï¼ŒExecutorï¼ŒStatementHandlerï¼ŒResultSetHandlerã€‚**

## SqlSessionFactoryBuilderğŸ¿

- **æ¯ä¸€ä¸ªMyBatisçš„åº”ç”¨ç¨‹åºçš„å…¥å£æ˜¯SqlSessionFactoryBuilderã€‚å®ƒçš„ä½œç”¨æ˜¯é€šè¿‡XMLé…ç½®æ–‡ä»¶åˆ›å»ºConfigurationå¯¹è±¡ï¼Œç„¶åé€šè¿‡buildæ–¹æ³•åˆ›å»ºSqlSessionFactoryå¯¹è±¡ã€‚**
```java
public class App
{
    public static void main(String[] args) throws Exception
    {
        // è¯»å–mybatis-config.xmlæ–‡ä»¶
        InputStream inputStream = Resources.getResourceAsStream("mybatis-config.xml");

        // åˆå§‹åŒ–mybatisï¼Œåˆ›å»ºSqlSessionFactoryç±»çš„å®ä¾‹
        SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);

        // åˆ›å»ºSessionå®ä¾‹
        SqlSession session = sqlSessionFactory.openSession();

        // æ“ä½œæ•°æ®åº“æ–¹æ³•ä¸€ï¼šè·å¾—xmlæ˜ å°„æ–‡ä»¶ä¸­å®šä¹‰çš„æ“ä½œè¯­å¥
        Person p = session.selectOne("cn.mybatis.mydemo.mapper.PersonMapper.selectPersonById", 1);
        // æ‰“å°Pesonå¯¹è±¡
        System.out.println(p);

        // æ“ä½œæ•°æ®åº“æ–¹æ³•äºŒï¼šè·å¾—mapperæ¥å£çš„ä»£ç†å¯¹è±¡
        PersonMapper pm = session.getMapper(PersonMapper.class);
        // ç›´æ¥è°ƒç”¨æ¥å£çš„æ–¹æ³•ï¼ŒæŸ¥è¯¢idä¸º1çš„Pesonæ•°æ®
        Person p2 = pm.selectPersonById(1);
        // æ‰“å°Pesonå¯¹è±¡
        System.out.println(p2);

        // æäº¤äº‹åŠ¡
        session.commit();
        // å…³é—­Session
        session.close();
    }
}
```

- **æ²¡æœ‰å¿…è¦æ¯æ¬¡è®¿é—®Mybatiså°±åˆ›å»ºä¸€æ¬¡SqlSessionFactoryBuilderï¼Œé€šå¸¸çš„åšæ³•æ˜¯åˆ›å»ºä¸€ä¸ªå…¨å±€çš„å¯¹è±¡å°±å¯ä»¥äº†ã€‚ç¤ºä¾‹ç¨‹åºå¦‚ä¸‹ï¼š**
```java
private static SqlSessionFactoryBuilder sqlSessionFactoryBuilder;
private static SqlSessionFactory sqlSessionFactory;

private static void init() throws IOException 
{
    String resource = "mybatis-config.xml";
    Reader reader = Resources.getResourceAsReader(resource);
    sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();
    sqlSessionFactory = sqlSessionFactoryBuilder.build(reader);
}
```
## SqlSessionFactoryğŸ§‚

- **SqlSessionFactoryçš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ›å»ºSqlSessionå¯¹è±¡ï¼Œå’ŒSqlSessionFactoryBuilderå¯¹è±¡ä¸€æ ·ï¼Œæ²¡æœ‰å¿…è¦æ¯æ¬¡è®¿é—®Mybatiså°±åˆ›å»ºä¸€æ¬¡SqlSessionFactoryï¼Œé€šå¸¸çš„åšæ³•æ˜¯åˆ›å»ºä¸€ä¸ªå…¨å±€çš„å¯¹è±¡å°±å¯ä»¥äº†ã€‚**
- **SqlSessionFactoryæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒä¸€æ—¦è¢«åˆ›å»ºï¼Œåº”è¯¥åœ¨åº”ç”¨æ‰§è¡ŒæœŸé—´éƒ½å­˜åœ¨ã€‚åœ¨åº”ç”¨è¿è¡ŒæœŸé—´ä¸è¦é‡å¤åˆ›å»ºå¤šæ¬¡ï¼Œå»ºè®®ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚**
## SqlSessionğŸ§ˆ

- **SqlSessionç±»çš„ä¸»è¦åŠŸèƒ½æ˜¯å®Œæˆä¸€æ¬¡æ•°æ®åº“çš„è®¿é—®å’Œç»“æœçš„æ˜ å°„ï¼Œå®ƒç±»ä¼¼äºä¸€æ¬¡ä¼šè¯æ¦‚å¿µï¼Œé¡¾å‘½åä¸ºï¼šSqlSessionã€‚**


- **SqlSessionç±»ä¼¼äºJDBCé‡Œé¢çš„Connectionï¼ŒConnectionä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒSqlSessionä¹Ÿä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ç”±äºä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥SqlSessionå¯¹è±¡çš„ä½œç”¨åŸŸéœ€é™åˆ¶æ–¹æ³•å†…ã€‚**


- **SqlSessionçš„é»˜è®¤å®ç°ç±»æ˜¯DefaultSqlSessionï¼Œå®ƒæœ‰ä¸¤ä¸ªå¿…é¡»é…ç½®çš„å±æ€§ï¼šConfigurationå’ŒExecutorã€‚mybatis-config.xmlä¸­çš„é…ç½®ï¼Œæœ€åä¼šè§£æxmlæˆConfigurationè¿™ä¸ªç±»ã€‚SqlSessionå¯¹æ•°æ®åº“çš„æ“ä½œéƒ½æ˜¯é€šè¿‡Executoræ¥å®Œæˆçš„ã€‚**


- **SqlSessionæœ‰ä¸€ä¸ªé‡è¦çš„æ–¹æ³•getMapperï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªæ–¹å¼æ˜¯ç”¨æ¥è·å–Mapperæ˜ å°„å™¨çš„ã€‚**
## ExecutorğŸ¥Ÿ

- **Executorå¯¹è±¡åœ¨åˆ›å»ºConfigurationå¯¹è±¡çš„æ—¶å€™åˆ›å»ºï¼Œå¹¶ä¸”ç¼“å­˜åœ¨Configurationå¯¹è±¡é‡Œã€‚**
- **Executorå¯¹è±¡çš„ä¸»è¦åŠŸèƒ½æ˜¯è°ƒç”¨StatementHandlerè®¿é—®æ•°æ®åº“ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœå­˜å…¥ç¼“å­˜ä¸­ï¼ˆå¦‚æœé…ç½®äº†ç¼“å­˜çš„è¯ï¼‰ã€‚**
## StatementHandlerğŸŒ¯

- **StatementHandleræ˜¯çœŸæ­£è®¿é—®æ•°æ®åº“çš„åœ°æ–¹ï¼Œå¹¶è°ƒç”¨ResultSetHandlerå¤„ç†æŸ¥è¯¢ç»“æœã€‚**
## ResultSetHandlerğŸ¥“

- **å¤„ç†æŸ¥è¯¢ç»“æœã€‚**
## MyBatisæ ¸å¿ƒç±»å±‚æ¬¡&èŒè´£ğŸ¥¨
<p>
<img :src="$withBase('/mybatis/mybatis082101_1.png')" alt="mybatis082101_1" class="medium-zoom-image">
</p>

```markdown
SqlSessionï¼Œä½œä¸ºMyBatiså·¥ä½œçš„ä¸»è¦é¡¶å±‚APIï¼Œè¡¨ç¤ºå’Œæ•°æ®åº“äº¤äº’çš„ä¼šè¯ï¼Œå®Œæˆå¿…è¦æ•°æ®åº“å¢åˆ æ”¹æŸ¥åŠŸèƒ½

Executorï¼ŒMyBatisæ‰§è¡Œå™¨ï¼Œæ˜¯MyBatisè°ƒåº¦çš„æ ¸å¿ƒï¼Œè´Ÿè´£SQLè¯­å¥çš„ç”Ÿæˆå’ŒæŸ¥è¯¢ç¼“å­˜çš„ç»´æŠ¤

StatementHandlerï¼Œå°è£…äº†JDBC Statementæ“ä½œï¼Œè´Ÿè´£å¯¹JDBC Statementçš„æ“ä½œï¼Œå¦‚è®¾ç½®å‚æ•°ã€å°†Statementç»“æœé›†è½¬æ¢æˆListé›†åˆã€‚

ParameterHandlerï¼Œè´Ÿè´£å¯¹ç”¨æˆ·ä¼ é€’çš„å‚æ•°è½¬æ¢æˆJDBC Statement æ‰€éœ€è¦çš„å‚æ•°

ResultSetHandlerï¼Œè´Ÿè´£å°†JDBCè¿”å›çš„ResultSetç»“æœé›†å¯¹è±¡è½¬æ¢æˆListç±»å‹çš„é›†åˆ

TypeHandlerï¼Œè´Ÿè´£Javaæ•°æ®ç±»å‹å’ŒJDBCæ•°æ®ç±»å‹ä¹‹é—´çš„æ˜ å°„å’Œè½¬æ¢

MappedStatementï¼ŒMappedStatementç»´æŠ¤äº†ä¸€æ¡select|update|delete|insertèŠ‚ç‚¹çš„å°è£…

SqlSourceï¼Œè´Ÿè´£æ ¹æ®ç”¨æˆ·ä¼ é€’çš„parameterObjectï¼ŒåŠ¨æ€åœ°ç”ŸæˆSQLè¯­å¥ï¼Œå°†ä¿¡æ¯å°è£…åˆ°BoundSqlå¯¹è±¡ä¸­ï¼Œå¹¶è¿”å›
BoundSqlï¼Œè¡¨ç¤ºåŠ¨æ€ç”Ÿæˆçš„SQLè¯­å¥ä»¥åŠç›¸åº”çš„å‚æ•°ä¿¡æ¯

Configurationï¼ŒMyBatisæ‰€æœ‰çš„é…ç½®ä¿¡æ¯éƒ½ç»´æŒåœ¨Configurationå¯¹è±¡ä¹‹ä¸­
```
