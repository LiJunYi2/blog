(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{581:function(a,t,s){"use strict";s.r(t);var n=s(2),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"什么是skywalking"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是skywalking"}},[a._v("#")]),a._v(" 什么是Skywalking")]),a._v(" "),s("p",[a._v("SkyWalking是一个开源APM系统，包含了云原生架构下的分布式系统的监控、跟踪、诊断功能。")]),a._v(" "),s("p",[a._v("skywalking支持dubbo，SpringCloud，SpringBoot集成，"),s("strong",[a._v("代码无侵入，通信方式采用GRPC，性能较好，实现方式是java探针，支持告警，支持JVM监控，支持全局调用统计")]),a._v("等等，功能较完善。")]),a._v(" "),s("h2",{attrs:{id:"skywalking和spring-cloud-sleuth-zipkin选型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#skywalking和spring-cloud-sleuth-zipkin选型"}},[a._v("#")]),a._v(" Skywalking和Spring Cloud Sleuth+ZipKin选型")]),a._v(" "),s("p",[s("strong",[a._v("Skywalking相比于zipkin还是有很大的优势的，如下：")])]),a._v(" "),s("ul",[s("li",[a._v("skywalking采用字节码增强的技术实现代码无侵入，zipKin代码侵入性比较高")]),a._v(" "),s("li",[a._v("skywalking功能比较丰富，报表统计，UI界面更加人性化")])]),a._v(" "),s("h2",{attrs:{id:"skywalking架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#skywalking架构"}},[a._v("#")]),a._v(" Skywalking架构")]),a._v(" "),s("p",[a._v("skywalking分为服务端和客户端，服务端负责收集日志数据并且展示，架构如下")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking01.png"),alt:"Skywalking01"}})]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("上面的Agent")]),a._v("：负责收集日志数据，并且传递给中间的OAP服务器")]),a._v(" "),s("li",[s("strong",[a._v("中间的OAP")]),a._v("：负责接收 Agent 发送的 Tracing 和Metric的数据信息，然后进行分析(Analysis Core) ，存储到外部存储器( Storage )，最终提供查询( Query )功能。")]),a._v(" "),s("li",[s("strong",[a._v("左面的UI")]),a._v("：负责提供web控制台，查看链路，查看各种指标，性能等等。")]),a._v(" "),s("li",[s("strong",[a._v("右面Storage")]),a._v("：负责数据的存储，支持多种存储类型。")])]),a._v(" "),s("p",[a._v("大致流程就是Agent负责收集日志传输数据，通过GRPC的方式传递给OAP进行分析并且存储到数据库中，最终通过UI界面将分析的统计报表、服务依赖、拓扑关系图展示出来。")]),a._v(" "),s("h2",{attrs:{id:"服务端搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务端搭建"}},[a._v("#")]),a._v(" 服务端搭建")]),a._v(" "),s("h3",{attrs:{id:"下载安装包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载安装包"}},[a._v("#")]),a._v(" 下载安装包")]),a._v(" "),s("p",[a._v("Skywalking同样是通过Jar包启动，点击"),s("a",{attrs:{href:"https://skywalking.apache.org/downloads/",target:"_blank",rel:"nofollow noopener noreferrer"}},[a._v("skywalking"),s("OutboundLink")],1),a._v("进入下载")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking02.png"),alt:"Skywalking02"}})]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking03.png"),alt:"Skywalking03"}})]),a._v(" "),s("p",[s("code",[a._v("Foundations")]),a._v(" 我们选择 "),s("code",[a._v("V9.0.1")]),a._v(" 进行下载，"),s("code",[a._v("Agents")]),a._v(" 选择 "),s("code",[a._v("V8.11.0")]),a._v(" 下载，解压后完整目录如下：")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking04.png"),alt:"Skywalking04"}})]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking05.png"),alt:"Skywalking05"}})]),a._v(" "),s("h3",{attrs:{id:"配置修改"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置修改"}},[a._v("#")]),a._v(" 配置修改")]),a._v(" "),s("h4",{attrs:{id:"_1、apache-skywalking-apm-bin-config下-application-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、apache-skywalking-apm-bin-config下-application-yml"}},[a._v("#")]),a._v(" 1、apache-skywalking-apm-bin\\config下 "),s("code",[a._v("application.yml")])]),a._v(" "),s("p",[a._v("这个是 "),s("code",[a._v("oap")]),a._v(" 服务的配置文件，需要修改注册中心为 "),s("code",[a._v("nacos")]),a._v("，如下图：")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking06.png"),alt:"Skywalking06"}})]),a._v(" "),s("h4",{attrs:{id:"_2、apache-skywalking-apm-bin-webapp下-webapp-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、apache-skywalking-apm-bin-webapp下-webapp-yml"}},[a._v("#")]),a._v(" 2、apache-skywalking-apm-bin\\webapp下 "),s("code",[a._v("webapp.yml")])]),a._v(" "),s("p",[a._v("这个是UI服务的配置文件，其中有一个 "),s("code",[a._v("server.port")]),a._v(" 配置，是UI服务的端口，默认"),s("strong",[a._v("8080")]),a._v("，避免端口冲突，修改为其他值：")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking07.png"),alt:"Skywalking07"}})]),a._v(" "),s("h4",{attrs:{id:"_3、启动服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、启动服务"}},[a._v("#")]),a._v(" 3、启动服务")]),a._v(" "),s("p",[a._v("先将"),s("code",[a._v("Nacos")]),a._v("启动，再启动"),s("code",[a._v("Skywalking")]),a._v("服务，Skywalking启动命令在/bin目录下，这里需要启动两个服务，如下：")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("oap服务")]),a._v("：对应的启动脚本oapService.bat，Linux下对应的后缀是sh")]),a._v(" "),s("li",[s("strong",[a._v("UI服务")]),a._v("：对应的启动脚本webappService.bat，Linux下对应的后缀是sh")])]),a._v(" "),s("p",[a._v("当然还有一个 "),s("code",[a._v("startup.bat")]),a._v(" 启动文件，可以直接启动上述两个服务，我们可以直接使用这个脚本，直接双击，将会弹出两个窗口则表示启动成功，如下图：")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking08.png"),alt:"Skywalking08"}})]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking09.png"),alt:"Skywalking09"}})]),a._v(" "),s("p",[a._v("然后浏览器直接访问：http://localhost:8888/general")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking10.png"),alt:"Skywalking10"}})]),a._v(" "),s("p",[a._v("目前还没有启动任何微服务，所以数据都是空的，接下来我们搭建客户端。")]),a._v(" "),s("h2",{attrs:{id:"客户端搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端搭建"}},[a._v("#")]),a._v(" 客户端搭建")]),a._v(" "),s("p",[a._v("由于Skywalking采用字节码增强技术，因此对于微服务无代码侵入，只要是普通的微服务即可，不需要引入什么依赖。")]),a._v(" "),s("p",[a._v("但是想要传输数据必须借助skywalking提供的agent，只需要在启动参数指定即可，命令如下：")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[a._v("-javaagent:G:\\java\\SpringCloud2020\\Skywalking\\skywalking-agent\\skywalking-agent.jar\n-Dskywalking.agent.service_name=cloud-gateway\n-Dskywalking.collector.backend_service=127.0.0.1:11800\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("ul",[s("li",[s("strong",[a._v("-javaagent")]),a._v("：指定skywalking中的agent中的"),s("code",[a._v("skywalking-agent.jar")]),a._v("的路径")]),a._v(" "),s("li",[s("strong",[a._v("-Dskywalking.agent.service_name")]),a._v("：指定在skywalking中的服务名称，一般是微服务的"),s("code",[a._v("spring.application.name")])]),a._v(" "),s("li",[s("strong",[a._v("-Dskywalking.collector.backend_service")]),a._v("：指定oap服务绑定的地址，由于陈某这里是本地，并且oap服务默认的端口是11800，因此只需要配置为"),s("code",[a._v("127.0.0.1:11800")])])]),a._v(" "),s("p",[a._v("上述参数可以在命令行通过"),s("code",[a._v("java -jar xxx")]),a._v("指定，在IDEA中操作如下图：")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking11.png"),alt:"Skywalking11"}})]),a._v(" "),s("p",[a._v("上述三个微服务都需要配置skywalking的启动配置，配置成功后正常启动即可。")]),a._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"title"}),s("p",[a._v("注意："),s("code",[a._v("agent")]),a._v("的"),s("code",[a._v("jar")]),a._v("包路径不能包含中文，不能有空格，否则运行不成功。")])]),s("p",[a._v("配置完成后启动服务，然后通过网关访问：http://localhost:9527/consumer/paymentSQL/1?uname=zhangsan")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking12.png"),alt:"Skywalking12"}})]),a._v(" "),s("p",[a._v("此时查看skywalking的UI端，可以看到几个微服务已经监控成功了，如下图：")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking13.png"),alt:"Skywalking13"}})]),a._v(" "),s("p",[a._v("服务之前的依赖关系也是可以很清楚的看到，如下图：")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking14.png"),alt:"Skywalking14"}})]),a._v(" "),s("p",[a._v("请求链路的信息也是能够很清楚的看到，比如请求的url，执行时间、调用的服务，如下图：")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking15.png"),alt:"Skywalking15"}})]),a._v(" "),s("h2",{attrs:{id:"数据持久化配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据持久化配置"}},[a._v("#")]),a._v(" 数据持久化配置")]),a._v(" "),s("p",[a._v("skywalking默认持久化的方式是存储在内存中，一旦服务重启则链路追踪数据就会丢失。skywalking提供了诸如ES、MySQL等方式进行数据的持久化，这里记录下使用MySQL进行数据持久化配置。")]),a._v(" "),s("h3",{attrs:{id:"_1、修改配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、修改配置文件"}},[a._v("#")]),a._v(" 1、修改配置文件")]),a._v(" "),s("p",[a._v("同样的，修改"),s("code",[a._v("apache-skywalking-apm-bin\\config")]),a._v("下"),s("code",[a._v("application.yml")])]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_STORAGE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mysql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("jdbcUrl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_JDBC_URL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"jdbc:mysql://localhost:3306/skywalking?rewriteBatchedStatements=true&characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useUnicode=true&useSSL=false&serverTimezone=UTC"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dataSource.user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_DATA_SOURCE_USER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dataSource.password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_DATA_SOURCE_PASSWORD"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dataSource.cachePrepStmts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_DATA_SOURCE_CACHE_PREP_STMTS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dataSource.prepStmtCacheSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_DATA_SOURCE_PREP_STMT_CACHE_SQL_SIZE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("250")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dataSource.prepStmtCacheSqlLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_DATA_SOURCE_PREP_STMT_CACHE_SQL_LIMIT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2048")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dataSource.useServerPrepStmts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_DATA_SOURCE_USE_SERVER_PREP_STMTS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadataQueryMaxSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_STORAGE_MYSQL_QUERY_MAX_SIZE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("maxSizeOfBatchSql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_STORAGE_MAX_SIZE_OF_BATCH_SQL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("asyncBatchPersistentPoolSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_STORAGE_ASYNC_BATCH_PERSISTENT_POOL_SIZE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br")])]),s("h3",{attrs:{id:"_2、添加msql的jdbc依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、添加msql的jdbc依赖"}},[a._v("#")]),a._v(" 2、添加MSQL的JDBC依赖")]),a._v(" "),s("p",[a._v("默认的"),s("code",[a._v("oap")]),a._v("中是没有"),s("code",[a._v("jdbc")]),a._v("驱动依赖，因此需要我们手动添加一下，只需要将驱动的jar放在"),s("strong",[a._v("oap-libs")]),a._v("文件夹中，如下图：")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking16.png"),alt:"Skywalking16"}})]),a._v(" "),s("p",[a._v("配置完成后，在本地创建好skywalking数据库，然后再启动skywalking服务端")]),a._v(" "),s("p",[a._v("启动完成后，skywalking数据库中将会自动创建表，如下图：")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking17.png"),alt:"Skywalking17"}})]),a._v(" "),s("h2",{attrs:{id:"日志监控"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日志监控"}},[a._v("#")]),a._v(" 日志监控")]),a._v(" "),s("p",[a._v("在skywalking的控制台上有一个日志菜单，用于收集客户端的日志，默认是没有数据的。")]),a._v(" "),s("p",[a._v("skywalking提供了主流的日志框架接入，像log4j，logback，log4j2等，这里将以"),s("strong",[a._v("logback")]),a._v("为例子记录一下如何配置日志框架，以下是一些官方接入日志框架的文档：")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://skywalking.apache.org/docs/skywalking-java/v8.8.0/en/setup/service-agent/java-agent/application-toolkit-log4j-1.x/",target:"_blank",rel:"nofollow noopener noreferrer"}},[a._v("log4j接入"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://skywalking.apache.org/docs/skywalking-java/v8.8.0/en/setup/service-agent/java-agent/application-toolkit-log4j-2.x/",target:"_blank",rel:"nofollow noopener noreferrer"}},[a._v("log4j2接入"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://skywalking.apache.org/docs/skywalking-java/v8.8.0/en/setup/service-agent/java-agent/application-toolkit-logback-1.x/",target:"_blank",rel:"nofollow noopener noreferrer"}},[a._v("logback接入"),s("OutboundLink")],1)])]),a._v(" "),s("h3",{attrs:{id:"_1、添加依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、添加依赖"}},[a._v("#")]),a._v(" 1、添加依赖")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n   "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.apache.skywalking"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n   "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("apm-toolkit-logback-1.x"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n   "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("${project.release.version}"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h3",{attrs:{id:"_2、添加日志配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、添加日志配置文件"}},[a._v("#")]),a._v(" 2、添加日志配置文件")]),a._v(" "),s("p",[a._v("新建一个"),s("code",[a._v("logback-spring.xml")]),a._v("放在resource目录下")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token prolog"}},[a._v('<?xml version="1.0" encoding="UTF-8"?>')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("configuration")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("scan")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("true"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("scanPeriod")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v(" 5 seconds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("appender")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("STDOUT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("ch.qos.logback.core.ConsoleAppender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("encoder")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("ch.qos.logback.core.encoder.LayoutWrappingEncoder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("layout")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("org.apache.skywalking.apm.toolkit.log.logback.v1.x.mdc.TraceIdMDCPatternLogbackLayout"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n                    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("Pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("%d{yyyy-MM-dd HH:mm:ss.SSS} [%X{tid}] [%thread] %-5level %logger{36} -%msg%n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("Pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("layout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("encoder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("appender")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    \n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("appender")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("ASYNC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("ch.qos.logback.classic.AsyncAppender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("discardingThreshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("0"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("discardingThreshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("queueSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("1024"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("queueSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("neverBlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("true"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("neverBlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("appender-ref")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("ref")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("STDOUT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("/>")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("appender")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    \n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("appender")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("grpc-log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("org.apache.skywalking.apm.toolkit.log.logback.v1.x.log.GRPCLogClientAppender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("encoder")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("ch.qos.logback.core.encoder.LayoutWrappingEncoder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("layout")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("org.apache.skywalking.apm.toolkit.log.logback.v1.x.mdc.TraceIdMDCPatternLogbackLayout"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("Pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("%d{yyyy-MM-dd HH:mm:ss.SSS} [%X{tid}] [%thread] %-5level %logger{36} -%msg%n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("Pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("layout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("encoder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("appender")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    \n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("root")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("level")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("appender-ref")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("ref")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("ASYNC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("/>")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("appender-ref")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("ref")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("grpc-log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("/>")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("root")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br")])]),s("h3",{attrs:{id:"配置完成后-启动服务-打开skywalking控制台就能看见日志模块的输出。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置完成后-启动服务-打开skywalking控制台就能看见日志模块的输出。"}},[a._v("#")]),a._v(" 配置完成后，启动服务，打开skywalking控制台就能看见日志模块的输出。")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking18.png"),alt:"Skywalking18"}})]),a._v(" "),s("p",[a._v("注意：如果"),s("strong",[a._v("agent")]),a._v("和"),s("strong",[a._v("oap")]),a._v("服务不在同一台服务器上，需要在"),s("code",[a._v("/agent/config/agent.config")]),a._v("配置文件末尾添加如下配置：")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定要向其报告日志数据的Grpc服务的主机，默认10.10.10.1")]),a._v("\nplugin.toolkit.log.grpc.reporter.server_host=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_GRPC_LOG_SERVER_HOST"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("10.10.10.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定要向其报告日志数据的Grpc服务的端口，默认11800")]),a._v("\nplugin.toolkit.log.grpc.reporter.server_port=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_GRPC_LOG_SERVER_PORT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11800")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定Grpc客户端要报告的日志数据的最大大小，默认10485760")]),a._v("\nplugin.toolkit.log.grpc.reporter.max_message_size=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_GRPC_LOG_MAX_MESSAGE_SIZE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10485760")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 客户端向上游发送数据时将超时多长时间，单位秒，默认30")]),a._v("\nplugin.toolkit.log.grpc.reporter.upstream_timeout=$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("SW_GRPC_LOG_GRPC_UPSTREAM_TIMEOUT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("30")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("h2",{attrs:{id:"监控告警"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#监控告警"}},[a._v("#")]),a._v(" 监控告警")]),a._v(" "),s("h3",{attrs:{id:"skywalking中有一些默认的告警规则-如下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#skywalking中有一些默认的告警规则-如下"}},[a._v("#")]),a._v(" skywalking中有一些默认的告警规则，如下：")]),a._v(" "),s("ul",[s("li",[a._v("最近3分钟内服务的平均响应时间超过1秒")]),a._v(" "),s("li",[a._v("最近2分钟服务成功率低于80%")]),a._v(" "),s("li",[a._v("最近3分钟90%服务响应时间超过1秒")]),a._v(" "),s("li",[a._v("最近2分钟内服务实例的平均响应时间超过1秒")])]),a._v(" "),s("p",[a._v("这些规则的配置在"),s("code",[a._v("apache-skywalking-apm-bin/config/alarm-settings.yml")]),a._v("配置文件中")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Sample alarm rules.")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("rules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Rule unique name, must be ended with `_rule`.")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("service_resp_time_rule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metrics-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" service_resp_time\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("op")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('">"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("threshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("period")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("count")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("silence-period")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Response time of service "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" is more than 1000ms in 3 minutes of last 10 minutes.\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("service_sla_rule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Metrics value need to be long, double or int")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metrics-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" service_sla\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("op")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("threshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8000")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# The length of time to evaluate the metrics")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("period")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# How many times after the metrics match the condition, will trigger alarm")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("count")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# How many times of checks, the alarm keeps silence after alarm triggered, default as same as period.")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("silence-period")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Successful rate of service "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" is lower than 80% in 2 minutes of last 10 minutes\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("service_resp_time_percentile_rule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Metrics value need to be long, double or int")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metrics-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" service_percentile\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("op")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('">"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("threshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("period")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("count")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("silence-period")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Percentile response time of service "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" alarm in 3 minutes of last 10 minutes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" due to more than one condition of p50 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),a._v(" 1000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" p75 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),a._v(" 1000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" p90 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),a._v(" 1000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" p95 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),a._v(" 1000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" p99 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),a._v(" 1000\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("service_instance_resp_time_rule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metrics-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" service_instance_resp_time\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("op")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('">"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("threshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("period")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("count")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("silence-period")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Response time of service instance "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" is more than 1000ms in 2 minutes of last 10 minutes\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("database_access_resp_time_rule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metrics-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" database_access_resp_time\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("threshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("op")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('">"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("period")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("count")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Response time of database access "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" is more than 1000ms in 2 minutes of last 10 minutes\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("endpoint_relation_resp_time_rule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metrics-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" endpoint_relation_resp_time\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("threshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("op")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('">"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("period")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("count")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Response time of endpoint relation "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" is more than 1000ms in 2 minutes of last 10 minutes\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("webhooks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#  - http://127.0.0.1/notify/")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#  - http://127.0.0.1/go-wechat/")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br"),s("span",{staticClass:"line-number"},[a._v("43")]),s("br"),s("span",{staticClass:"line-number"},[a._v("44")]),s("br"),s("span",{staticClass:"line-number"},[a._v("45")]),s("br"),s("span",{staticClass:"line-number"},[a._v("46")]),s("br"),s("span",{staticClass:"line-number"},[a._v("47")]),s("br"),s("span",{staticClass:"line-number"},[a._v("48")]),s("br"),s("span",{staticClass:"line-number"},[a._v("49")]),s("br"),s("span",{staticClass:"line-number"},[a._v("50")]),s("br"),s("span",{staticClass:"line-number"},[a._v("51")]),s("br"),s("span",{staticClass:"line-number"},[a._v("52")]),s("br"),s("span",{staticClass:"line-number"},[a._v("53")]),s("br"),s("span",{staticClass:"line-number"},[a._v("54")]),s("br"),s("span",{staticClass:"line-number"},[a._v("55")]),s("br"),s("span",{staticClass:"line-number"},[a._v("56")]),s("br"),s("span",{staticClass:"line-number"},[a._v("57")]),s("br"),s("span",{staticClass:"line-number"},[a._v("58")]),s("br")])]),s("h3",{attrs:{id:"每个规则都由相同的属性组成-这些属性的含义如下图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#每个规则都由相同的属性组成-这些属性的含义如下图"}},[a._v("#")]),a._v(" 每个规则都由相同的属性组成，这些属性的含义如下图：")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking19.png"),alt:"Skywalking19"}})]),a._v(" "),s("p",[a._v("除了以上几种默认的规则，Skywalking还提供了webhooks方法，相当于一个回调，一旦触发了上述规则告警，skywalking则会调用配置的webhook，这就给开发者们提供了告警的后置处理，比如发送"),s("strong",[a._v("告警邮件")]),a._v("、"),s("strong",[a._v("告警短信")]),a._v("等等。")]),a._v(" "),s("p",[a._v("但是webhooks也有自己的一些规则：")]),a._v(" "),s("ul",[s("li",[a._v("POST请求")]),a._v(" "),s("li",[s("strong",[a._v("application/json")]),a._v(" 接收数据")]),a._v(" "),s("li",[a._v("接收的参数必须是"),s("a",{attrs:{href:"https://github.com/apache/skywalking/blob/master/oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/alarm/AlarmMessage.java",target:"_blank",rel:"nofollow noopener noreferrer"}},[a._v("AlarmMessage"),s("OutboundLink")],1),a._v("中指定的参数。")])]),a._v(" "),s("p",[a._v("其中，AlarmMessage类不同版本可能会有所不同，需要自行找到对应版本的源码去拷贝其属性。对应的源码的路径："),s("code",[a._v("org.apache.skywalking.oap.server.core.alarm")]),a._v("。")]),a._v(" "),s("p",[s("img",{staticClass:"medium-zoom-image",attrs:{src:a.$withBase("/SpringCloud/Skywalking20.png"),alt:"Skywalking20"}})]),a._v(" "),s("h3",{attrs:{id:"新建一个告警模块-代码如下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建一个告警模块-代码如下"}},[a._v("#")]),a._v(" 新建一个告警模块，代码如下：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@RestController")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@RequestMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"alarm"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Slf4j")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AlarmController")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@PostMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/receive"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("receive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@RequestBody")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AlarmMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"处理一些通知告警事项"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("JSON"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("toJSONString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("p",[a._v("然后在"),s("code",[a._v("apache-skywalking-apm-bin/config/alarm-settings.yml")]),a._v("中配置")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("webhooks:\n#  - http://127.0.0.1/alarm/receive\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);